//register
app.post("/register", async(req, res) => {
  const {firstName,lastName,username,password}=req.body;

  try{
    const UserDoc= await User.create({firstName,lastName,username,password:bcrypt.hashSync(password,salt)});
    res.json(UserDoc);
  }catch(e) {
      res.status(400).json(e);
  }
});


//login 
app.post("/login", async(req, res) => {
  const {username,password}=req.body;



  const userDoc=await User.findOne({username});
  const passOK=bcrypt.compareSync(password, userDoc.password)

  res.json(userDoc)

  if(passOK){
    jwt.sign({username,role:userDoc.role_name},secret,{},(err,token)=>{
        if(err) throw err;
        res.cookie('token',token).json('ok');
    })
  }else{
    res.status(400).json("Invalid username or password");
  }
});





NAVBAR.JS


import React from 'react'
import "../style/Movie.css";
import {Link} from "react-router-dom"
import MovieContext from '../services/MovieContext'
import {useState,useContext,useEffect} from "react";
import axios from "axios";
import UserContext from "../services/UserContext";

function Navbar() {


  const { test } = useContext(UserContext);
  const {favorites,handleSearch}=useContext(MovieContext);



  let getCookie = () => {
    axios
      .get("http://localhost:8000/profile")
      .then((res) => {
        res.json().then(userInfo=>{
          setUsername(userInfo.username)
        })
        console.log(res.data);
        setUser(res.data)
      })
      .catch((error) => {
        console.log(error);
      });
  };
  useEffect(() => {
    getCookie();
  }, []);




  const logout=()=>{
    axios
      .post("http://localhost:8000/logout")
      .then((res) => {
        localStorage.setItem('token','')

       setUsername(null)
       setRole(null)
      })
      .catch((error) => {
        console.log(error);
      });
  }



  return (
    
    <div className='navbar'>
        <Link to="/" className='navbar_logo'><h1>MovieApp</h1></Link>
        {user.username}
        <div className="navbar_search">
            <input
              type="text"
              placeholder="Search Movie..."
              className="search-bar"
              onChange={handleSearch}
            />
          </div>



        <ul className='navbar_links'>    
        <li> <Link to="/movies" className="navbar_link"><h3>All Movies</h3></Link></li>
        <li> <Link to="/favorites" className="navbar_link"><h3>Watchlist ({favorites.length})</h3></Link></li>
        <li> <Link to="/movie/create" className="navbar_link"><h3>Create New Movie</h3></Link></li>
        <li> <Link to="/login" className="navbar_link"><h3>Login</h3></Link></li>
        <li> <button onClick={logout}>Logout</button></li>
        </ul>  
    </div>
    
  )
}

export default Navbar






LOGIN.JS

import React, { useState } from "react";
import { Link ,useNavigate} from "react-router-dom";
import axios from "axios";

export default function Login() {
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");
  const navigate=useNavigate();


  const savedLocalStorageToken = JSON.parse(localStorage.getItem("token") || "[]");
  const [user,setUser]=useState(savedLocalStorageToken);
  
  const handleLogin = (e) => {
    e.preventDefault();
    const loginData={username,password}
    axios
      .post("http://localhost:8000/login", loginData)
      .then((res) => {
        localStorage.setItem('token',JSON.stringify(res.data))
        res.JSON().then(userInfo=>{
          setUser(userInfo)
        })
        navigate("/")
      })
      .catch((err) => {
        console.log(err);
      });
  };

  console.log("test userinfa",user.role)

  return (
    <div className="login">
      <form action="" className="login_form" onSubmit={handleLogin}>
        <input
          type="text"
          required
          placeholder="Username.."
          value={username}
          onChange={(e) => {
            setUsername(e.target.value);
          }}
        />
        {user.username}
        <br/>
        {user.role}
        <input
          type="password"
          required
          placeholder="Password.."
          value={password}
          onChange={(e) => {
            setPassword(e.target.value);
          }}
        />

        <button className="register_button" onClick={handleLogin}>
          Login
        </button>
      </form>




      <Link to="/register" className="Link">
        <h3>Register</h3>
      </Link>
    </div>
  );
}




 {user.role==="role_admin" ?         <li> <Link to="/movie/create" className="navbar_link"><h3>Create New Movie</h3></Link></li> 
: <h1>Nott</h1>      } 